name: CI/CD for MERN BLOG APP

on:
  push:
     branches:
          - main
  pull_request:
     branches:
          - main


jobs:
   build:
      runs-on: ubuntu-latest
      
      steps:
         - name: Checkout Repository
           uses: actions/checkout@v4
         
         - name: Set up node.js
           uses: actions/setup-node@v4
           with:
              node-version: 21
         - name: Install Backend Dependencies
           run: |
              cd api
              npm install
   docker:
      needs: build
      runs-on: ubuntu-latest
      
      steps:
         - name: Checkout Repository
           uses: actions/checkout@v4

         - name: Log into Docker Hub
           uses: docker/login-action@v3
           with:
              usename: ${{ secrets.DOCKER_USERNAME }}
              password: ${{ secrets.DOCKER_PASSWORD }}  
         - name: Build and Push Docker Images
           run: |
              docker-compose build
              docker tag blog_api:latest ${{ secrets.DOCKER_USERNAME }}/blog-api:latest
              docker tag blog_client:latest ${{ secrets.DOCKER_USERNAME }}/blog-client:latest
              docker push ${{ secrets.DOCKER_USERNAME }}/blog-api:latest
              docker push ${{ secrets.DOCKER_USERNAME }}/blog-client:latest 
     